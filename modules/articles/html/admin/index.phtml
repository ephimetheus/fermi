<?php

$extract = function($article_collection) use (&$extract) {
	
	echo '<ul class="">' ;
	
	foreach($article_collection as $article)
	{
		echo '<li>' ;
		
		echo '<a href="" id="article_'.$article->getId().'">'.$article->name.'</a>' ; 
		
		$children = $article->getChildren() ;
		
		if(count($children) != 0)
		{
			$extract($children) ;
		}
		
		echo '</li>' ;
	}
	
	
	
	echo '</ul>' ;
	
} ;

?>

<script type="text/javascript">

$(document).ready(function(){
 	var tree_transaction_log = {test: 'bla'} ;

	$('.structure_tree').jstree({
		core : { /* core options go here */ },
		
		
		plugins : [ "themes", "html_data", 'crrm', 'dnd', 'json_data', 'cookies'],
		
	});
	
	$('.structure_tree').bind('move_node.jstree', function(e, data) {
		
		var target = data.args[0]['cr'] ;
		var node_id = data.args[0]['o']['context']['id'].substring(8) ;
		
		if(typeof target != 'object')
		{	
			var target_id = 'NULL'
		}
		else
		{
			var target_id = target['context']['id'].substring(8) ;
		}
		
		tree_transaction_log[''+node_id+''] = target_id ;
		
		
	}) ;
	
	/*$('#json').click(function() {
		
		console.log(JSON.stringify($('.structure_base_container').jstree('get_json'), {}, '	')) ;
		
	}) ;*/
	
}) ;

</script>

<div class="structure_wrapper">

<div class="structure_base_container">
	

<div class="structure_tree">
<?php

	$extract($tpl->root_articles) ;

?>
</div>

<div class="structure_actions">
	
	<button><?=I18n::_('save')?></button>
	
</div>

</div>

<div class="structure_content">
	<h1><?=I18n::_('Structure')?>: <?=Request::get('action')?></h1>
	
	
</div>


<br style="clear:both;" />
</div>