<?php

$extract = function($category) use (&$extract) {
	
	echo '<li class="structure_category"><span class="structure_category_handle">'.$category->name.'</span>' ;
	
	$children = $category->getChildren() ;
	$articles = $category->getArticles() ;
	
	if(count($children) !== 0 OR count($articles) !== 0)
	{
		
	
	echo '<ol>' ;
	foreach($children as $child)
	{
		
		$extract($child) ;
		
	}
	
	echo '</li>' ;
	
	
	foreach($articles as $article)
	{
		echo '<li class="structure_article"><span>'.$article->name.'</span></li>' ;
	}
	echo '</ol>' ;
	
	
	}
	
} ;

?>

<script>
$(document).ready(function(){
 
		$('ol.sortable').nestedSortable({
			disableNesting: 'structure_article',
			forcePlaceholderSize: true,
			handle: 'span',
			helper:	'clone',
			items: 'li',
			maxLevels: 3,
			opacity: .6,
			placeholder: 'placeholder',
			revert: 250,
			tabSize: 25,
			tolerance: 'pointer',
			toleranceElement: '> span'
		});
		
		$('.structure_category_handle').bind('mousedown', function() {
			
			//alert('down') ;
			return false ;
			
		}) ;
		
}) ;
</script>
<div class="structure_base_container">
	
<ol class="structure_base sortable">

<?php

foreach($tpl->categories as $category)
{
	$extract($category) ;
}

foreach($tpl->articles as $article)
{
	echo '<li class="structure_article"><span>'.$article->name.'</span></li>' ;
}


?>

</ol>

</div>